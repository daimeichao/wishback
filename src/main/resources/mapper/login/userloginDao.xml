<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jiading.modules.back.userlogin.dao.UserLoginDao">

    <!-- 登录获取用户信息 -->
	<select id="getUserInfoByUserId" parameterType="map" resultType="map">
        SELECT
	h.zgh AS NO,
	h.xm AS NAME,
	`i`.`department_id` AS `FK_Dept`,
	e.name as FK_DeptName,
	'1' AS `Type`







FROM
	fjcpcudw.t_gxjg_jzgjbxx h left join `fjcpcmwczxy`.`user_dtype_relation` i on i.user_id =h.zgh left join
	(
SELECT
	`a`.`DWDM` AS `id`,
	`a`.`DWMC` AS `name`,
	'1' AS `p_id`,
	'0' AS `del_status`,
IF
	( ( `a`.`DWLBM` = '1' ), '1', '11' ) AS `d_type`,
	'0' AS `o_type`,
	NULL AS `seal_url`
FROM
	`fjcpcudw`.`t_gxxx_yxsdwxx` `a`
UNION ALL
SELECT
	'1' AS `id`,
	'福建船政交通职业学院' AS `name`,
	'0' AS `p_id`,
	'0' AS `del_status`,
	'0' AS `d_type`,
	'0' AS `o_type`,
	NULL AS `seal_url` UNION ALL
SELECT
	`a`.`ZYDM` AS `id`,
	`a`.`ZYDMC` AS `name`,
	`a`.`DWH` AS `p_id`,
	'0' AS `del_status`,
	'2' AS `d_type`,
	'0' AS `o_type`,
	NULL AS `seal_url`
FROM
	`fjcpcudw`.`t_gxjx_xszyxx` `a`
WHERE
	`a`.`ZYDM` IN (
SELECT
	`b`.`ZYDM`
FROM
	( `fjcpcudw`.`t_gxjx_xszyxx` `b` JOIN `fjcpcudw`.`t_gxxx_bjjbxx` `c` ON ( ( `c`.`ZYDM` = `b`.`ZYDM` ) ) )
WHERE
	( ( `c`.`BJDM` IS NOT NULL ) AND ( LEFT ( `c`.`BJMC`, 2 ) >= '18' ) )
	) UNION ALL
SELECT
	`a`.`BJDM` AS `id`,
	`a`.`BJMC` AS `name`,
	`a`.`ZYDM` AS `p_id`,
	'0' AS `del_status`,
	'3' AS `d_type`,
	'0' AS `o_type`,
	NULL AS `seal_url`
FROM
	`fjcpcudw`.`t_gxxx_bjjbxx` `a`
WHERE
	( LEFT ( `a`.`BJMC`, 2 ) >= '18' )
) as e on e.id=`i`.`department_id`


WHERE
		h.zgh =  #{userId}
	and i.isdel='0' group by h.zgh


UNION ALL
SELECT
	j.xh,
	j.xm,
	k.`department_id` AS `FK_Dept`,
	e.name as FK_DeptName,
	'0' AS `Type`



FROM
	fjcpcudw.t_gxxs_xsjbxx j left join `fjcpcmwczxy`.`user_dtype_relation` k on k.user_id =j.xh left join
	(
SELECT
	`a`.`DWDM` AS `id`,
	`a`.`DWMC` AS `name`,
	'1' AS `p_id`,
	'0' AS `del_status`,
IF
	( ( `a`.`DWLBM` = '1' ), '1', '11' ) AS `d_type`,
	'0' AS `o_type`,
	NULL AS `seal_url`
FROM
	`fjcpcudw`.`t_gxxx_yxsdwxx` `a`
UNION ALL
SELECT
	'1' AS `id`,
	'福建船政交通职业学院' AS `name`,
	'0' AS `p_id`,
	'0' AS `del_status`,
	'0' AS `d_type`,
	'0' AS `o_type`,
	NULL AS `seal_url` UNION ALL
SELECT
	`a`.`ZYDM` AS `id`,
	`a`.`ZYDMC` AS `name`,
	`a`.`DWH` AS `p_id`,
	'0' AS `del_status`,
	'2' AS `d_type`,
	'0' AS `o_type`,
	NULL AS `seal_url`
FROM
	`fjcpcudw`.`t_gxjx_xszyxx` `a`
WHERE
	`a`.`ZYDM` IN (
SELECT
	`b`.`ZYDM`
FROM
	( `fjcpcudw`.`t_gxjx_xszyxx` `b` JOIN `fjcpcudw`.`t_gxxx_bjjbxx` `c` ON ( ( `c`.`ZYDM` = `b`.`ZYDM` ) ) )
WHERE
	( ( `c`.`BJDM` IS NOT NULL ) AND ( LEFT ( `c`.`BJMC`, 2 ) >= '18' ) )
	) UNION ALL
SELECT
	`a`.`BJDM` AS `id`,
	`a`.`BJMC` AS `name`,
	`a`.`ZYDM` AS `p_id`,
	'0' AS `del_status`,
	'3' AS `d_type`,
	'0' AS `o_type`,
	NULL AS `seal_url`
FROM
	`fjcpcudw`.`t_gxxx_bjjbxx` `a`
WHERE
	( LEFT ( `a`.`BJMC`, 2 ) >= '18' )
) as e on e.id=`k`.`department_id`


WHERE
	j.xh = #{userId}

	LIMIT 1



    </select>

</mapper>